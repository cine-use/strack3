!function(re){re.Jcrop=function(e,t){function g(e){return Math.round(e)+"px"}function b(e){return S.baseClass+"-"+e}function u(e){var t=re(e).offset();return[t.left,t.top]}function n(e){return[e.pageX-C[0],e.pageY-C[1]]}function o(e){"object"!=typeof e&&(e={}),S=re.extend(S,e),re.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof S[t]&&(S[t]=function(){})})}function r(e,t,n){if(C=u(D),te.setCursor("move"===e?e:e+"-resize"),"move"===e)return te.activateHandlers((o=t,ne.watchKeys(),function(e){$.moveOffset([e[0]-o[0],e[1]-o[1]]),o=e,ee.update()}),l,n);var o,r,a,i=$.getFixed(),s=d(e),c=$.getCorner(d(s));$.setPressed($.getCorner(s)),$.setCurrent(c),te.activateHandlers((r=e,a=i,function(e){if(S.aspectRatio)switch(r){case"e":case"w":e[1]=a.y+1;break;case"n":e[0]=a.x+1;break;case"s":e[0]=a.x+1}else switch(r){case"e":case"w":e[1]=a.y2;break;case"n":e[0]=a.x2;break;case"s":e[0]=a.x2}$.setCurrent(e),ee.update()}),l,n)}function d(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function w(t){return function(e){return S.disabled||("move"!==t||S.allowMove)&&(C=u(D),X=!0,r(t,n(e)),e.stopPropagation(),e.preventDefault()),!1}}function s(e,t,n){var o=e.width(),r=e.height();t<o&&0<t&&(r=(o=t)/e.width()*e.height()),n<r&&0<n&&(o=(r=n)/e.height()*e.width()),q=e.width()/o,L=e.height()/r,e.width(o).height(r)}function v(e){return{x:e.x*q,y:e.y*L,x2:e.x2*q,y2:e.y2*L,w:e.w*q,h:e.h*L}}function l(){var e=$.getFixed();e.w>S.minSelect[0]&&e.h>S.minSelect[1]?(ee.enableHandles(),ee.done()):ee.release(),te.setCursor(S.allowSelect?"crosshair":"default")}function a(e){if(!S.disabled&&S.allowSelect){X=!0,C=u(D),ee.disableHandles(),te.setCursor("crosshair");var t=n(e);return $.setPressed(t),ee.update(),te.activateHandlers(i,l,"touch"===e.type.substring(0,5)),ne.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}}function i(e){$.setCurrent(e),ee.update()}function y(){var e=re("<div></div>").addClass(b("tracker"));return z&&e.css({opacity:0,backgroundColor:"white"}),e}function c(e){m([e[0]/q,e[1]/L,e[2]/q,e[3]/L]),S.onSelect.call(oe,v($.getFixed())),ee.enableHandles()}function m(e){$.setPressed([e[0],e[1]]),$.setCurrent([e[2],e[3]]),ee.update()}function h(){S.disabled=!0,ee.disableHandles(),ee.setCursor("default"),te.setCursor("default")}function f(){S.disabled=!1,x()}function p(e,t,n){var o=t||S.bgColor;S.bgFade&&re.fx.step.hasOwnProperty("backgroundColor")&&S.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:S.fadeTime}):e.css("backgroundColor",o)}function x(e){S.allowResize?e?ee.enableOnly():ee.enableHandles():ee.disableHandles(),te.setCursor(S.allowSelect?"crosshair":"default"),ee.setCursor(S.allowMove?"move":"default"),S.hasOwnProperty("trueSize")&&(q=S.trueSize[0]/I,L=S.trueSize[1]/B),S.hasOwnProperty("setSelect")&&(c(S.setSelect),ee.done(),delete S.setSelect),_.refresh(),S.bgColor!=Q&&(p(S.shade?_.getShades():P,S.shade&&S.shadeColor||S.bgColor),Q=S.bgColor),U!=S.bgOpacity&&(U=S.bgOpacity,S.shade?_.refresh():ee.setBgOpacity(U)),K=S.maxSize[0]||0,E=S.maxSize[1]||0,W=S.minSize[0]||0,Y=S.minSize[1]||0,S.hasOwnProperty("outerImage")&&(D.attr("src",S.outerImage),delete S.outerImage),ee.refresh()}var C,S=re.extend({},re.Jcrop.defaults),k=navigator.userAgent.toLowerCase(),z=/msie/.test(k),M=/msie [1-6]\./.test(k);"object"!=typeof e&&(e=re(e)[0]),"object"!=typeof t&&(t={}),o(t);var O={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute"},j=re(e),F=!0;if("IMG"==e.tagName){if(0!=j[0].width&&0!=j[0].height)j.width(j[0].width),j.height(j[0].height);else{var H=new Image;H.src=j[0].src,j.width(H.width),j.height(H.height)}var D=j.clone().removeAttr("id").css(O).show();D.width(j.width()),D.height(j.height()),j.after(D).hide()}else D=j.css(O).show(),F=!1,null===S.shade&&(S.shade=!0);s(D,S.boxWidth,S.boxHeight);var I=D.width(),B=D.height(),P=re("<div />").width(I).height(B).addClass(b("holder")).css({position:"absolute",top:re(e).css("top"),left:re(e).css("left")}).insertAfter(j).append(D);S.addClass&&P.addClass(S.addClass);var J=re("<div />"),A=re("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),R=re("<div />").width("100%").height("100%").css("zIndex",320),T=re("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=$.getFixed();S.onDblClick.call(oe,e)}).insertBefore(D).append(A,R);F&&(J=re("<img />").attr("src",D.attr("src")).css(O).width(I).height(B),A.append(J)),M&&T.css({overflowY:"hidden"});var K,E,W,Y,q,L,X,G,N=S.boundary,V=y().width(I+2*N).height(B+2*N).css({position:"absolute",top:g(-N),left:g(-N),zIndex:290}).mousedown(a),Q=S.bgColor,U=S.bgOpacity;C=u(D);var Z=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e],a=(r="on"+r)in o;a||(o.setAttribute(r,"return;"),a="function"==typeof o[r]),t[n[e]]=a}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}return{createDragger:function(t){return function(e){return S.disabled||("move"!==t||S.allowMove)&&(C=u(D),X=!0,r(t,n(Z.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return a(Z.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:!0===S.touchSupport||!1===S.touchSupport?S.touchSupport:e()}}(),$=function(){function n(){if(!S.aspectRatio)return t=y-w,n=m-v,K&&Math.abs(t)>K&&(y=0<t?w+K:w-K),E&&Math.abs(n)>E&&(m=0<n?v+E:v-E),Y/L&&Math.abs(n)<Y/L&&(m=0<n?v+Y/L:v-Y/L),W/q&&Math.abs(t)<W/q&&(y=0<t?w+W/q:w-W/q),w<0&&(y-=w,w-=w),v<0&&(m-=v,v-=v),y<0&&(w-=y,y-=y),m<0&&(v-=m,m-=m),I<y&&(w-=e=y-I,y-=e),B<m&&(v-=e=m-B,m-=e),I<w&&(m-=e=w-B,v-=e),B<v&&(m-=e=v-B,v-=e),b(g(w,v,y,m));var e,t,n,o,r,a,i,s=S.aspectRatio,c=S.minSize[0]/q,u=S.maxSize[0]/q,d=S.maxSize[1]/L,l=y-w,h=m-v,f=Math.abs(l),p=Math.abs(h);return 0===u&&(u=10*I),0===d&&(d=10*B),f/p<s?(r=m,a=p*s,(o=l<0?w-a:a+w)<0?(o=0,i=Math.abs((o-w)/s),r=h<0?v-i:i+v):I<o&&(o=I,i=Math.abs((o-w)/s),r=h<0?v-i:i+v)):(o=y,i=f/s,(r=h<0?v-i:v+i)<0?(r=0,a=Math.abs((r-v)*s),o=l<0?w-a:a+w):B<r&&(r=B,a=Math.abs(r-v)*s,o=l<0?w-a:a+w)),w<o?(o-w<c?o=w+c:u<o-w&&(o=w+u),r=v<r?v+(o-w)/s:v-(o-w)/s):o<w&&(w-o<c?o=w-c:u<w-o&&(o=w-u),r=v<r?v+(w-o)/s:v-(w-o)/s),o<0?(w-=o,o=0):I<o&&(w-=o-I,o=I),r<0?(v-=r,r=0):B<r&&(v-=r-B,r=B),b(g(w,v,o,r))}function t(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>I&&(e[0]=I),e[1]>B&&(e[1]=B),[Math.round(e[0]),Math.round(e[1])]}function g(e,t,n,o){var r=e,a=n,i=t,s=o;return n<e&&(r=n,a=e),o<t&&(i=o,s=t),[r,i,a,s]}function b(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var o,r,w=0,v=0,y=0,m=0;return{flipCoords:g,setPressed:function(e){e=t(e),y=w=e[0],m=v=e[1]},setCurrent:function(e){e=t(e),o=e[0]-y,r=e[1]-m,y=e[0],m=e[1]},getOffset:function(){return[o,r]},moveOffset:function(e){var t=e[0],n=e[1];w+t<0&&(t-=t+w),v+n<0&&(n-=n+v),B<m+n&&(n+=B-(m+n)),I<y+t&&(t+=I-(y+t)),w+=t,y+=t,v+=n,m+=n},getCorner:function(e){var t=n();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:n}}(),_=function(){function e(){return t($.getFixed())}function t(e){d.top.css({left:g(e.x),width:g(e.w),height:g(e.y)}),d.bottom.css({top:g(e.y2),left:g(e.x),width:g(e.w),height:g(B-e.y2)}),d.right.css({left:g(e.x2),width:g(I-e.x2)}),d.left.css({width:g(e.x)})}function n(){return re("<div />").css({position:"absolute",backgroundColor:S.shadeColor||S.bgColor}).appendTo(u)}function o(){c||(c=!0,u.insertBefore(D),e(),ee.setBgOpacity(1,0,1),J.hide(),r(S.shadeColor||S.bgColor,1),ee.isAwake()?i(S.bgOpacity,1):i(1,1))}function r(e,t){p(s(),e,t)}function a(){c&&(u.remove(),J.show(),c=!1,ee.isAwake()?ee.setBgOpacity(S.bgOpacity,1,1):(ee.setBgOpacity(1,1,1),ee.disableHandles()),p(P,0,1))}function i(e,t){c&&(S.bgFade&&!t?u.animate({opacity:1-e},{queue:!1,duration:S.fadeTime}):u.css({opacity:1-e}))}function s(){return u.children()}var c=!1,u=re("<div />").css({position:"absolute",zIndex:240,opacity:0}),d={top:n(),left:n().height(B),right:n().height(B),bottom:n()};return{update:e,updateRaw:t,getShades:s,setBgColor:r,enable:o,disable:a,resize:function(e,t){d.left.css({height:g(t)}),d.right.css({height:g(t)})},refresh:function(){S.shade?o():a(),ee.isAwake()&&i(S.bgOpacity)},opacity:i}}(),ee=function(){function a(e,t){var n=re("<div />").mousedown(w(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return Z.support&&n.bind("touchstart.jcrop",Z.createDragger(e)),R.append(n),n}function e(){var e=$.getFixed();$.setPressed([e.x,e.y]),$.setCurrent([e.x2,e.y2]),t()}function t(e){return c?n(e):void 0}function n(e){var t,n,o,r,a=$.getFixed();o=a.w,r=a.h,T.width(Math.round(o)).height(Math.round(r)),t=a.x,n=a.y,S.shade||J.css({top:g(-n),left:g(-t)}),T.css({top:g(n),left:g(t)}),S.shade&&_.updateRaw(a),c||(T.show(),S.shade?_.opacity(U):i(U,!0),c=!0),e?S.onSelect.call(oe,v(a)):S.onChange.call(oe,v(a))}function i(e,t,n){(c||t)&&(S.bgFade&&!n?D.animate({opacity:e},{queue:!1,duration:S.fadeTime}):D.css("opacity",e))}function o(){return f=!0,S.allowResize?(R.show(),!0):void 0}function r(){f=!1,R.hide()}function s(e){e?(G=!0,r()):(G=!1,o())}var c,u=370,d={},l={},h={},f=!1;S.dragEdges&&re.isArray(S.createDragbars)&&function(e){var t;for(t=0;t<e.length;t++)h[e[t]]=a(e[t],u++).addClass("jcrop-dragbar")}(S.createDragbars),re.isArray(S.createHandles)&&function(e){var t,n,o,r;for(t=0;t<e.length;t++)l[e[t]]=(n=e[t],r=void 0,o=S.handleSize,r=a(n,u++).css({opacity:S.handleOpacity}).addClass(b("handle")),o&&r.width(o).height(o),r)}(S.createHandles),S.drawBorders&&re.isArray(S.createBorders)&&function(e){var t,n,o,r;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}d[e[n]]=(o=t,r=re("<div />").css({position:"absolute",opacity:S.borderOpacity}).addClass(b(o)),A.append(r),r)}}(S.createBorders),re(document).bind("touchstart.jcrop-ios",function(e){re(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var p=y().mousedown(w("move")).css({cursor:"move",position:"absolute",zIndex:360});return Z.support&&p.bind("touchstart.jcrop",Z.createDragger("move")),A.append(p),r(),{updateVisible:t,update:n,release:function(){r(),T.hide(),S.shade?_.opacity(1):i(1),c=!1,S.onRelease.call(oe)},refresh:e,isAwake:function(){return c},setCursor:function(e){p.css("cursor",e)},enableHandles:o,enableOnly:function(){f=!0},showHandles:function(){f&&R.show()},disableHandles:r,animMode:s,setBgOpacity:i,done:function(){s(!1),e()}}}(),te=function(){function r(e){return c(n(e)),!1}function a(e){return e.preventDefault(),e.stopPropagation(),X&&(X=!1,u(n(e)),ee.isAwake()&&S.onSelect.call(oe,v($.getFixed())),V.css({zIndex:290}),re(document).unbind(".jcrop"),c=function(){},u=function(){}),!1}function i(e){return c(n(Z.cfilter(e))),!1}function s(e){return a(Z.cfilter(e))}var c=function(){},u=function(){},d=S.trackDocument;return d||V.mousemove(r).mouseup(a).mouseout(a),D.before(V),{activateHandlers:function(e,t,n){return X=!0,c=e,u=t,o=n,V.css({zIndex:450}),o?re(document).bind("touchmove.jcrop",i).bind("touchend.jcrop",s):d&&re(document).bind("mousemove.jcrop",r).bind("mouseup.jcrop",a),!1;var o},setCursor:function(e){V.css("cursor",e)}}}(),ne=function(){function n(e,t,n){S.allowMove&&($.moveOffset([t,n]),ee.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}var e=re('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),t=re("<div />").css({position:"absolute",overflow:"hidden"}).append(e);return S.keySupport&&(e.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:n(e,-t,0);break;case 39:n(e,t,0);break;case 38:n(e,0,-t);break;case 40:n(e,0,t);break;case 27:S.allowSelect&&ee.release();break;case 9:return!0}return!1}).blur(function(){e.hide()}),M||!S.fixedSupport?(e.css({position:"absolute",left:"-20px"}),t.append(e).insertBefore(D)):e.insertBefore(D)),{watchKeys:function(){S.keySupport&&(e.show(),e.focus())}}}();Z.support&&V.bind("touchstart.jcrop",Z.newSelection),R.hide(),x(!0);var oe={setImage:function(r,a){ee.release(),h();var i=new Image;i.onload=function(){var e=i.width,t=i.height,n=S.boxWidth,o=S.boxHeight;D.width(e).height(t),D.attr("src",r),J.attr("src",r),s(D,n,o),I=D.width(),B=D.height(),J.width(I).height(B),V.width(I+2*N).height(B+2*N),P.width(I).height(B),_.resize(I,B),f(),"function"==typeof a&&a.call(oe)},i.src=r},animateTo:function(e,t){function n(){window.setTimeout(v,l)}var o=e[0]/q,r=e[1]/L,a=e[2]/q,i=e[3]/L;if(!G){var s=$.flipCoords(o,r,a,i),c=$.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=S.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=S.swingSpeed;o=d[0],r=d[1],a=d[2],i=d[3],ee.animMode(!0);var v=function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(r+b/100*f),d[2]=Math.round(a+b/100*p),d[3]=Math.round(i+b/100*g),99.8<=b&&(b=100),b<100?(m(d),n()):(ee.done(),ee.animMode(!1),"function"==typeof t&&t.call(oe))};n()}},setSelect:c,setOptions:function(e){o(e),x()},tellSelect:function(){return v($.getFixed())},tellScaled:function(){return $.getFixed()},setClass:function(e){P.removeClass().addClass(b("holder")).addClass(e)},disable:h,enable:f,cancel:function(){ee.done(),te.activateHandlers(null,null)},release:ee.release,destroy:function(){P.remove(),j.show(),j.css("visibility","visible"),re(e).removeData("Jcrop")},focus:ne.watchKeys,getBounds:function(){return[I*q,B*L]},getWidgetSize:function(){return[I,B]},getScaleFactor:function(){return[q,L]},getOptions:function(){return S},ui:{holder:P,selection:T}};return z&&P.bind("selectstart",function(){return!1}),j.data("Jcrop",oe),oe},re.fn.Jcrop=function(e,t){var n;return this.each(function(){if(re(this).data("Jcrop")){if("api"===e)return re(this).data("Jcrop");re(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?re.Jcrop.Loader(this,function(){re(this).css({display:"block",visibility:"hidden"}),n=re.Jcrop(this,e),re.isFunction(t)&&t.call(n)}):(re(this).css({display:"block",visibility:"hidden"}),n=re.Jcrop(this,e),re.isFunction(t)&&t.call(n))}),this},re.Jcrop.Loader=function(e,t,n){var o=re(e),r=o[0];o.bind("load.jcloader",function e(){r.complete?(o.unbind(".jcloader"),re.isFunction(t)&&t.call(r)):window.setTimeout(e,50)}).bind("error.jcloader",function(){o.unbind(".jcloader"),re.isFunction(n)&&n.call(r)}),r.complete&&re.isFunction(t)&&(o.unbind(".jcloader"),t.call(r))},re.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);