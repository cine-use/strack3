$(function(){function t(e,a){Strack.open_dialog("dialog",{title:StrackLang.Modify_Timelog_Item,width:480,height:180,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mtimelog_id",type:"hidden",name:"id",valid:1,value:e.id}],items:[{case:1,id:"Mtimelog_iname",type:"text",lang:StrackLang.Timelog_Item_Name,name:"name",valid:"1,128",value:e.name}],footer:[{obj:"update_timelog",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),close:function(){$("#"+a).datagrid("reload")}})}function i(e,a){Strack.open_dialog("dialog",{title:StrackLang.Modify_Time_Calendar,width:480,height:360,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mcalendar_id",type:"hidden",name:"id",valid:1,value:e.id}],items:[{case:1,id:"Mcalendar_name",type:"text",lang:StrackLang.Time_Calendar_Name,name:"name",valid:"1,128",value:e.name},{case:2,id:"Mcalendar_start",type:"text",lang:StrackLang.Start_Date,name:"start_time",valid:"1",value:""},{case:2,id:"Mcalendar_end",type:"text",lang:StrackLang.End_Date,name:"end_time",valid:"1",value:""},{case:2,id:"Mcalendar_type",type:"text",lang:StrackLang.Type,name:"type",valid:"1",value:e.type}],footer:[{obj:"update_timeCalendar_set",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.OpenDateBox("#Mcalendar_start",378,26,e.start_time),Strack.OpenDateBox("#Mcalendar_end",378,26,e.end_time),Strack.combobox_widget("#Mcalendar_type",{url:SchedulPHP.getCalendarTypeList,valueField:"id",textField:"name",width:378,height:26,value:e.type})},close:function(){$("#"+a).datagrid("reload")}})}function n(e){var a=Math.floor(e/3600),t=Math.floor(e%3600/60);return Strack.prefix_integer(a,2)+":"+Strack.prefix_integer(t,2)}obj={switch_schedul:function(e){var a=$(e).data("tab");$("#sc_nomenu").hide(),$(".templates-items").removeClass("templates-active"),$(e).parent().addClass("templates-active"),function(e){switch($(".temp-setlist-tab").removeClass("temp-d-active"),$("#sc_"+e).addClass("temp-d-active"),e){case"workhours":$.ajax({type:"POST",url:SchedulPHP.getScheduleWorkdaySetting,beforeSend:function(){$("#sc_workhours").append(Strack.loading_dom("white","","workhour"))},dataType:"json",success:function(e){$("#workday_start").timespinner({height:35,width:500,value:n(e.start)}),$("#workday_end").timespinner({height:35,width:500,value:n(e.end)}),$("#exclude_date").combobox({url:SchedulPHP.getScheduleExcludeList,width:500,height:35,valueField:"id",textField:"name",value:e.exclude_date,multiple:!0});var a=e.days.split(",");$("#workday_list").find(".workday-item").each(function(){0<=$.inArray($(this).data("day"),a)&&$(this).addClass("workday-ac")}),$("#st-load_workhour").remove()}});break;case"reminders":$.ajax({type:"POST",url:SchedulPHP.getReminderSetting,dataType:"json",beforeSend:function(){$("#sc_workhours").append(Strack.loading_dom("white","","reminders"))},success:function(e){$("#reminders_title").val(e.rtitle),$("#reminders_body").val(e.rbody),Strack.init_open_switch({dom:"#reminders_on",value:e.ropen,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}),$("#st-load_reminders").remove()}});break;case"ctimelog":$("#datagrid_timelog").datagrid({url:SchedulPHP.getTimelogGridData,rownumbers:!0,nowrap:!0,height:Strack.panel_height("#sc_ctimelog",0),DragSelect:!0,adaptive:{dom:"#sc_ctimelog",min_width:300,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"timelog_issue_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(e,a,t){return a.id}},{field:"name",title:StrackLang.Name,align:"center",width:300}]],toolbar:"#timelog_tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,a){$(this).datagrid("selectRow",e),t(a,"datagrid_box")}});break;case"calendar":$("#datagrid_calendar").datagrid({url:SchedulPHP.getCalendarGridData,rownumbers:!0,nowrap:!0,height:Strack.panel_height("#sc_calendar",0),DragSelect:!0,adaptive:{dom:"#sc_calendar",min_width:300,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"calendar_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(e,a,t){return a.id}},{field:"name",title:StrackLang.Name,align:"center",width:220},{field:"start_time",title:StrackLang.Start_Date,align:"center",width:160},{field:"end_time",title:StrackLang.End_Date,align:"center",width:160},{field:"type",title:StrackLang.Type,align:"center",width:160},{field:"created_by",title:StrackLang.Created_by,align:"center",width:180}]],toolbar:"#calendar_tb",pagination:!0,pageSize:50,pageList:[50,100],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,a){$(this).datagrid("selectRow",e),i(a,"datagrid_box")}})}}(a)},check_workday:function(e){$(e).data("day");$(e).hasClass("workday-ac")?$(e).removeClass("workday-ac"):$(e).addClass("workday-ac")},save_work_time:function(){var e=$("#workday_start"),a=e.timespinner("getHours"),t=e.timespinner("getMinutes"),i=$("#workday_end"),n=i.timespinner("getHours"),d=i.timespinner("getMinutes"),r=Strack.get_combos_val("#exclude_date","combobox","getValues"),l=[],o=r||[],c=3600*a+60*t,g=3600*n+60*d;c||(c=0),g||(g=0),$("#workday_list").find(".workday-item").each(function(){$(this).hasClass("workday-ac")&&l.push($(this).data("day"))}),$.ajax({type:"POST",url:SchedulPHP.saveScheduleWorkdaySetting,data:{start:c,end:g,exclude_date:o.join(","),days:l.join(",")},dataType:"json",beforeSend:function(){$("#sc_workhours").append(Strack.loading_dom("white","","workhour"))},success:function(e){200===parseInt(e.status)?Strack.top_message({bg:"g",msg:e.message}):layer.msg(e.message,{icon:7,time:1200,anim:6}),$("#st-load_workhour").remove()}})},save_reminder_set:function(){var e=Strack.get_switch_val(),a=$("#reminders_title").val(),t=$("#reminders_body").val();0<e&&0===a.length?layer.msg(StrackLang.Reminders_Title_NULL,{icon:2,time:1200,anim:6}):0<e&&0===t.length?layer.msg(StrackLang.Reminders_Content_NULL,{icon:2,time:1200,anim:6}):$.ajax({type:"POST",url:SchedulPHP.saveReminderSetting,data:{ropen:e,rtitle:a,rbody:t},dataType:"json",beforeSend:function(){$("#sc_reminders").append(Strack.loading_dom("white","","reminders"))},success:function(e){200===parseInt(e.status)?Strack.top_message({bg:"g",msg:e.message}):layer.msg(e.message,{icon:7,time:1200,anim:6}),$("#st-load_reminders").remove()}})},add_timelog:function(){Strack.open_dialog("dialog",{title:StrackLang.Add_Timelog_Item,width:480,height:180,content:Strack.dialog_dom({type:"normal",items:[{case:1,id:"Ntimelog_name",type:"text",lang:StrackLang.Timelog_Item_Name,name:"name",valid:"1,128",value:""}],footer:[{obj:"update_timelog_issue",type:1,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]})})},update_timelog_issue:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",SchedulPHP.addTimelogIssue,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_timelog").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},modify_timelog:function(){var e=$("#datagrid_timelog").datagrid("getSelections");e.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):1<e.length?layer.msg(StrackLang.Only_Choose_One,{icon:2,time:1200,anim:6}):t(e[0],"datagrid_box")},update_timelog:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",SchedulPHP.modifyTimelogIssue,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_timelog").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},delete_timelog:function(){Strack.ajax_grid_delete("datagrid_timelog","id",StrackLang.Delete_Timelog_Notice,SchedulPHP.deleteTimelogIssue)},add_calendar:function(){Strack.open_dialog("dialog",{title:StrackLang.Add_TimeCalendar_Title,width:480,height:360,content:Strack.dialog_dom({type:"normal",items:[{case:1,id:"calendar_name",type:"text",lang:StrackLang.Time_Calendar_Name,name:"name",valid:"1,128",value:""},{case:2,id:"calendar_start",type:"text",lang:StrackLang.Start_Date,name:"start_time",valid:"1",value:""},{case:2,id:"calendar_end",type:"text",lang:StrackLang.End_Date,name:"end_time",valid:"1",value:""},{case:2,id:"calendar_type",type:"text",lang:StrackLang.Type,name:"type",valid:"1",value:""}],footer:[{obj:"submit_calendar",type:1,title:StrackLang.Submit},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.OpenDateBox("#calendar_start",378,26),Strack.OpenDateBox("#calendar_end",378,26),Strack.combobox_widget("#calendar_type",{url:SchedulPHP.getCalendarTypeList,valueField:"id",textField:"name",width:378,height:26})}})},submit_calendar:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",SchedulPHP.addCalendar,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_calendar").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},modify_calendar:function(){var e=$("#datagrid_calendar").datagrid("getSelections");e.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):1<e.length?layer.msg(StrackLang.Only_Choose_One,{icon:2,time:1200,anim:6}):i(e[0],"datagrid_box")},update_timeCalendar_set:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",SchedulPHP.modifyCalendar,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message}),$("#datagrid_calendar").datagrid("reload")):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},delete_calendar:function(){Strack.ajax_grid_delete("datagrid_calendar","id",StrackLang.Delete_Calendar_Notice,SchedulPHP.deleteCalendar)}}});