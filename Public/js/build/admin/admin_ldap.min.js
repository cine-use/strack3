$(function(){function e(a){return a.split(/[\n]/)}function n(a,t){Strack.open_dialog("dialog",{title:StrackLang.Modify_Ldap_Title,width:490,height:460,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mldap_id",type:"hidden",name:"id",valid:1,value:a.id}],items:[{case:1,id:"Mldap_name",type:"text",lang:StrackLang.Ldap_Name,name:"name",valid:"1,128",value:a.name},{case:7,id:"Mdomain_controllers",type:"text",lang:StrackLang.Ldap_Server_Address,name:"domain_controllers",valid:"1",value:a.domain_controllers.join("\n")},{case:1,id:"Mbase_dn",type:"text",lang:StrackLang.Ldap_Base_DN,name:"base_dn",valid:"1,255",value:a.base_dn},{case:1,id:"Madmin_username",type:"text",lang:StrackLang.Ldap_Admin_Name,name:"admin_username",valid:"1,255",value:a.admin_username},{case:1,id:"Madmin_password",type:"text",lang:StrackLang.Ldap_Admin_Password,name:"admin_password",valid:"1,255",value:a.admin_password},{case:1,id:"Mport",type:"text",lang:StrackLang.Ldap_Port,name:"port",valid:"",value:a.port},{case:2,id:"Mldap_ssl",lang:StrackLang.Ldap_Open_Ssl,name:"ssl",valid:""},{case:2,id:"Mldap_tsl",lang:StrackLang.Ldap_Open_Tsl,name:"tsl",valid:""},{case:7,id:"Mdn_whitelist",type:"text",lang:StrackLang.Ldap_DN_Whitelist,name:"dn_whitelist",valid:"",value:a.dn_whitelist.join("\n")}],footer:[{obj:"ldap_update",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.init_open_switch({dom:"#Mldap_ssl",value:a.ssl,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}),Strack.init_open_switch({dom:"#Mldap_tsl",value:a.tsl,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100})},close:function(){$("#"+t).datagrid("reload")}})}obj={ldap_add:function(a){var t=Strack.validate_form("add_ldap");200===t.status&&(t.data.domain_controllers=e(t.data.domain_controllers),t.data.dn_whitelist=e(t.data.dn_whitelist),t.data.port||(t.data.port=389),$.ajax({type:"POST",url:LdapPHP.addLdap,data:JSON.stringify(t.data),dataType:"json",contentType:"application/json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(a){$.messager.progress("close"),200===parseInt(a.status)?(obj.ldap_reset(),Strack.top_message({bg:"g",msg:a.message})):layer.msg(a.message,{icon:7,time:1200,anim:6})}}))},ldap_modify:function(){var a=$("#datagrid_box").datagrid("getSelections");a.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):1<a.length?layer.msg(StrackLang.Only_Choose_One,{icon:2,time:1200,anim:6}):n(a[0],"datagrid_box")},ldap_update:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",LdapPHP.modifyLdap,{back:function(a){200===parseInt(a.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:a.message})):layer.msg(a.message,{icon:7,time:1200,anim:6})}},{extra:function(a){return a.domain_controllers=e(a.domain_controllers),a.dn_whitelist=e(a.dn_whitelist),a.port||(a.port=389),a}})},ldap_delete:function(){Strack.ajax_grid_delete("datagrid_box","id",StrackLang.Delete_Ldap_Notice,LdapPHP.deleteLdap)},ldap_reset:function(){$("#datagrid_box").datagrid("reload")}},Strack.init_open_switch({dom:"#ldap_ssl,#ldap_tsl",value:0,onText:StrackLang.Switch_ON,offText:StrackLang.Switch_OFF,width:100}),$("#datagrid_box").datagrid({url:LdapPHP.getLdapGridData,rownumbers:!0,nowrap:!0,height:Strack.panel_height(".admin-dept-right",0),DragSelect:!0,adaptive:{dom:".admin-dept-right",min_width:1004,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"ldap_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(a,t,e){return t.id}},{field:"name",title:StrackLang.Ldap_Name,align:"center",width:180},{field:"domain_controllers",title:StrackLang.Ldap_Server_Address,align:"center",width:320,formatter:function(a,t,e){return a.join(" ; ")}},{field:"base_dn",title:StrackLang.Ldap_Base_DN,align:"center",width:160},{field:"admin_username",title:StrackLang.Ldap_Admin_Name,align:"center",width:140},{field:"admin_password",title:StrackLang.Ldap_Admin_Password,align:"center",width:140},{field:"port",title:StrackLang.Ldap_Port,align:"center",width:120},{field:"ssl",title:StrackLang.Ldap_Open_Ssl,align:"center",width:90,formatter:function(a,t,e){return 0===parseInt(a)?"off":"on"}},{field:"tsl",title:StrackLang.Ldap_Open_Tsl,align:"center",width:90,formatter:function(a,t,e){return 0===parseInt(a)?"off":"on"}},{field:"dn_whitelist",title:StrackLang.Ldap_DN_Whitelist,align:"center",width:480,formatter:function(a,t,e){return a.join(" ; ")}}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(a,t){$(this).datagrid("selectRow",a),n(t,"datagrid_box")}})});