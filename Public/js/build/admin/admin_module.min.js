$(function(){function t(e,a){Strack.open_dialog("dialog",{title:StrackLang.Modify_Module,width:480,height:360,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mmodule_id",type:"hidden",name:"id",valid:1,value:e.id},{case:101,id:"Mtype",type:"hidden",name:"type",valid:1,value:e.type}],items:[{case:2,id:"Mmodule_icon",lang:StrackLang.Icon,name:"icon",valid:1},{case:1,id:"Mmodule_name",type:"text",lang:StrackLang.Name,name:"name",valid:"1,128",value:e.name},{case:1,id:"Mmodule_code",lang:StrackLang.Code,name:"code",valid:"1,128",value:e.code},{case:1,id:"Mmodule_number",lang:StrackLang.Number,name:"number",valid:"1,9",value:e.number}],footer:[{obj:"module_modify_update",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.combobox_widget("#Mmodule_icon",{url:StrackPHP.getIconList,valueField:"icon",textField:"icon",value:e.icon,formatter:function(e){return'<div class="combo-icons-warp" style="overflow: hidden"><div class="combo-icons aign-left"><i class="'+e.icon+'"></i></div><div class="combo-name">'+e.icon+"</div></div>"}}),$("#Mmodule_name").inputmask("*{1,128}"),$("#Mmodule_code").inputmask("alphaDash"),$("#Mmodule_number").inputmask("9{1,9}")},close:function(){$("#"+a).datagrid("reload")}})}obj={module_add:function(){var e=Strack.validate_form("add_module");200===parseInt(e.status)&&$.ajax({type:"POST",url:ModulePHP.addModule,data:e.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackPHP.Waiting,msg:StrackPHP.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),obj.module_reset()):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},module_modify:function(){var e=$("#datagrid_box").datagrid("getSelections");e.length<1?layer.msg(StrackPHP.Please_Select_One,{icon:2,time:1200,anim:6}):1<e.length?layer.msg(StrackPHP.Only_Choose_One,{icon:2,time:1200,anim:6}):t(e[0],"datagrid_box")},module_modify_update:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",ModulePHP.modifyModule,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message})):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},module_delete:function(){Strack.ajax_grid_delete("datagrid_box","id",StrackLang.Module_Delete_Comfirm,ModulePHP.deleteModule)},module_reset:function(){$("#datagrid_box").datagrid("reload")}},$("#type").combobox({url:ModulePHP.getModuleTypeList,width:300,height:30,valueField:"type_id",textField:"type_name",value:"entity",onSelect:function(e){var a=$("#fixed_module"),t=$("#module_code"),i=$("#module_number");switch(e.type_id){case"fixed":a.show(),t.attr("disabled","disabled"),i.attr("disabled","disabled");break;case"entity":a.hide(),t.removeAttr("disabled").val(""),i.removeAttr("disabled").val("")}}}),$("#fixmodule_list").combobox({url:ModulePHP.getFixedModuleList,width:300,height:30,valueField:"id",textField:"name",onSelect:function(e){$("#module_code").val(e.id),$("#module_number").val(0)}}),Strack.combobox_widget("#module_icon",{url:StrackPHP.getIconList,valueField:"icon",textField:"icon",width:300,height:30,formatter:function(e){return'<div class="combo-icons-warp" style="overflow: hidden"><div class="combo-icons aign-left"><i class="'+e.icon+'"></i></div><div class="combo-name">'+e.icon+"</div></div>"}}),$("#module_name").inputmask("*{1,128}"),$("#module_code").inputmask("alphaDash"),$("#module_number").inputmask("9{1,9}"),$("#datagrid_box").datagrid({url:ModulePHP.getModuleData,rownumbers:!0,nowrap:!0,DragSelect:!0,height:Strack.panel_height(".admin-dept-right",0),adaptive:{dom:".admin-dept-right",min_width:474,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"module_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(e,a,t){return a.id}},{field:"type",title:StrackLang.Type,align:"center",width:160},{field:"icon",title:StrackLang.Icon,align:"center",width:85,formatter:function(e,a,t){return'<i class="'+e+'"></i>'}},{field:"name",title:StrackLang.Name,align:"center",width:200},{field:"code",title:StrackLang.Code,align:"center",width:160},{field:"number",title:StrackLang.Number,align:"center",width:160}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,a){$(this).datagrid("selectRow",e),t(a,"datagrid_box")}})});