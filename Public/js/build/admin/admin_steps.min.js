$(function(){function a(e,t){Strack.open_dialog("dialog",{title:StrackLang.Modify_Step,width:480,height:340,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mstep_id",type:"hidden",name:"id",valid:1,value:e.id}],items:[{case:1,id:"Mstep_name",type:"text",lang:StrackLang.Name,name:"name",valid:"1,128",value:e.name},{case:1,id:"Mstep_code",lang:StrackLang.Code,name:"code",valid:"1,128",value:e.code},{case:2,id:"Mstep_color",lang:StrackLang.Color,name:"color",valid:"6,6"}],footer:[{obj:"step_update",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.color_pick_widget("#Mstep_color","hex","light",e.color,320),$("#Mstep_code").inputmask("alphaDash")},close:function(){$("#"+t).datagrid("reload")}})}obj={step_add:function(){var e=Strack.validate_form("add_step");200===e.status&&$.ajax({type:"POST",url:StepsPHP.addStep,data:e.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),obj.step_reset()):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},step_modify:function(){var e=$("#datagrid_box").datagrid("getSelections");e.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):1<e.length?layer.msg(StrackLang.Only_Choose_One,{icon:2,time:1200,anim:6}):a(e[0],"datagrid_box")},step_update:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",StepsPHP.modifyStep,{back:function(e){200===parseInt(e.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:e.message})):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},step_delete:function(){Strack.ajax_grid_delete("datagrid_box","id",StrackLang.Delelte_Step_Notice,StepsPHP.deleteStep)},step_reset:function(){$("#datagrid_box").datagrid("reload")}},Strack.color_pick_widget("#step_color","hex","light"),$("#step_code").inputmask("alphaDash"),$("#datagrid_box").datagrid({url:StepsPHP.getStepGridData,rownumbers:!0,nowrap:!0,fitColumns:Strack.fit_columns(".admin-dept-right",474),height:Strack.panel_height(".admin-dept-right",0),DragSelect:!0,adaptive:{dom:".admin-dept-right",min_width:474,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"step_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(e,t,a){return t.id}},{field:"color",title:StrackLang.Color,align:"center",width:136,formatter:function(e,t,a){return'<div class="picker-color" style="background-color: #'+e+'">#'+e+"</div>"}},{field:"name",title:StrackLang.Name,align:"center",width:260},{field:"code",title:StrackLang.Code,align:"center",width:260}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(e,t){$(this).datagrid("selectRow",e),a(t,"datagrid_box")}})});