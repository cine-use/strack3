$(function(){function e(a,t){Strack.open_dialog("dialog",{title:StrackLang.Modify_Tag,width:480,height:300,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mtag_id",type:"hidden",name:"id",valid:1,value:a.id}],items:[{case:1,id:"Mname",type:"text",lang:StrackLang.Name,name:"name",valid:1,value:a.name,mask:"*{1,40}"},{case:2,id:"Mtag_color",lang:StrackLang.Color,name:"color",valid:"6,6"},{case:2,id:"Mtag_type",lang:StrackLang.Type,name:"type",valid:"1"}],footer:[{obj:"tags_update",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.color_pick_widget("#Mtag_color","hex","light",a.color,320),Strack.combobox_widget("#Mtag_type",{url:StrackPHP.getTagTypeList,valueField:"id",textField:"name",value:a.type}),$("#Mname").inputmask()},close:function(){$("#"+t).datagrid("reload")}})}obj={tags_add:function(){var a=Strack.validate_form("add_tags");200===a.status&&$.ajax({type:"POST",url:TagsPHP.addTag,data:a.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(a){$.messager.progress("close"),200===parseInt(a.status)?(Strack.top_message({bg:"g",msg:a.message}),obj.tag_reset()):layer.msg(a.message,{icon:7,time:1200,anim:6})}})},tags_modify:function(){var a=$("#datagrid_box").datagrid("getSelections");a.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):1<a.length?layer.msg(StrackLang.Only_Choose_One,{icon:2,time:1200,anim:6}):e(a[0],"datagrid_box")},tags_update:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",TagsPHP.modifyTag,{back:function(a){200===parseInt(a.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:a.message})):layer.msg(a.message,{icon:7,time:1200,anim:6})}})},tags_delete:function(){Strack.ajax_grid_delete("datagrid_box","id",StrackLang.Delete_Tag_notice,TagsPHP.deleteTag)},tag_reset:function(){$("#datagrid_box").datagrid("reload")}},Strack.color_pick_widget("#tags_color","hex","light"),Strack.combobox_widget("#tags_type",{url:StrackPHP.getTagTypeList,valueField:"id",textField:"name",width:300,height:30}),$(":input").inputmask(),$("#datagrid_box").datagrid({url:TagsPHP.getTagGridData,rownumbers:!0,nowrap:!0,height:Strack.panel_height(".admin-dept-right",0),DragSelect:!0,adaptive:{dom:".admin-dept-right",min_width:1004,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"tag_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(a,t,e){return t.id}},{field:"color",title:StrackLang.Color,align:"center",width:180,formatter:function(a,t,e){return'<div class="picker-color" style="background-color: #'+a+'">#'+a+"</div>"}},{field:"name",title:StrackLang.Name,align:"center",width:260},{field:"type",title:StrackLang.Type,align:"center",width:180}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(a,t){$(this).datagrid("selectRow",a),e(t,"datagrid_box")}})});