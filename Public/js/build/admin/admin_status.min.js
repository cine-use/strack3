$(function(){function e(t,a){Strack.open_dialog("dialog",{title:StrackLang.Modify_Status_Title,width:480,height:400,content:Strack.dialog_dom({type:"normal",hidden:[{case:101,id:"Mstatus_id",type:"hidden",name:"id",valid:1,value:t.id}],items:[{case:1,id:"Mstatus_name",type:"text",lang:StrackLang.Name,name:"name",valid:"1,128",value:t.name},{case:1,id:"Mstatus_code",type:"text",lang:StrackLang.Code,name:"code",valid:"1,128",value:t.code},{case:2,id:"Mstatus_color",lang:StrackLang.Color,name:"color",valid:"6,6"},{case:2,id:"Mstatus_Icon",lang:StrackLang.Icon,name:"icon",valid:"1,24"},{case:2,id:"Mstatus_Cponds",lang:StrackLang.Corresponds,name:"correspond",valid:"1"}],footer:[{obj:"status_update",type:1,title:StrackLang.Update},{obj:"dialog_cancel",type:8,title:StrackLang.Cancel}]}),inits:function(){Strack.color_pick_widget("#Mstatus_color","hex","light",t.color,320),Strack.combobox_widget("#Mstatus_Icon",{url:StrackPHP.getIconList,valueField:"icon",textField:"icon",value:t.icon,formatter:function(t){return'<div class="combo-icons-warp" style="overflow: hidden"><div class="combo-icons aign-left"><i class="'+t.icon+'"></i></div><div class="combo-name">'+t.icon+"</div></div>"}}),Strack.combobox_widget("#Mstatus_Cponds",{url:StrackPHP.getStatusCorresponds,valueField:"id",textField:"name",value:t.correspond}),$("#Mstatus_code").inputmask("alphaDash")},close:function(){$("#"+a).datagrid("reload")}})}obj={status_add:function(){var t=Strack.validate_form("add_status");200===parseInt(t.status)&&$.ajax({type:"POST",url:StatusPHP.addStatus,data:t.data,dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(t){$.messager.progress("close"),200===parseInt(t.status)?(Strack.top_message({bg:"g",msg:t.message}),obj.status_reset()):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},status_modify:function(){var t=$("#datagrid_box").datagrid("getSelections");t.length<1?layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6}):1<t.length?layer.msg(StrackLang.Only_Choose_One,{icon:2,time:1200,anim:6}):e(t[0],"datagrid_box")},status_update:function(){Strack.ajax_dialog_form("#st_dialog_form .dialog-widget-val","",StatusPHP.modifyStatus,{back:function(t){200===parseInt(t.status)?(Strack.dialog_cancel(),Strack.top_message({bg:"g",msg:t.message})):layer.msg(t.message,{icon:7,time:1200,anim:6})}})},status_delete:function(){Strack.ajax_grid_delete("datagrid_box","id",StrackLang.Delete_Status_Notice,StatusPHP.deleteStatus)},status_reset:function(){$("#datagrid_box").datagrid("reload")}},Strack.color_pick_widget("#status_color","hex","light"),Strack.combobox_widget("#status_icon",{url:StrackPHP.getIconList,valueField:"icon",textField:"icon",width:300,height:30,formatter:function(t){return'<div class="combo-icons-warp" style="overflow: hidden"><div class="combo-icons aign-left"><i class="'+t.icon+'"></i></div><div class="combo-name">'+t.icon+"</div></div>"}}),Strack.combobox_widget("#status_corresponds",{url:StrackPHP.getStatusCorresponds,valueField:"id",textField:"name",width:300,height:30}),$("#status_code").inputmask("alphaDash"),$("#datagrid_box").datagrid({url:StatusPHP.getStatusGridData,rownumbers:!0,nowrap:!0,fitColumns:Strack.fit_columns(".admin-dept-right",1004),height:Strack.panel_height(".admin-dept-right",0),DragSelect:!0,adaptive:{dom:".admin-dept-right",min_width:1004,exth:0},frozenColumns:[[{field:"id",checkbox:!0}]],columns:[[{field:"status_id",title:StrackLang.ID,align:"center",width:80,frozen:"frozen",findex:0,formatter:function(t,a,e){return a.id}},{field:"icon",title:StrackLang.Icon,align:"center",width:60,formatter:function(t,a,e){return'<i class="'+t+'" style="color: #'+a.status_color+'"></i>'}},{field:"color",title:StrackLang.Color,align:"center",width:180,formatter:function(t,a,e){return'<div class="picker-color" style="background-color: #'+t+'">#'+t+"</div>"}},{field:"name",title:StrackLang.Name,align:"center",width:260},{field:"code",title:StrackLang.Code,align:"center",width:260},{field:"correspond_name",title:StrackLang.Corresponds,align:"center",width:260}]],toolbar:"#tb",pagination:!0,pageSize:100,pageList:[100,200],pageNumber:1,pagePosition:"bottom",remoteSort:!1,onDblClickRow:function(t,a){$(this).datagrid("selectRow",t),e(a,"datagrid_box")}})});