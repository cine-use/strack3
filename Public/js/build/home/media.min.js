$(function(){var g=function(e){if(this===window)return new g(e);switch(this.obj=e||{},this.frameRate=this.obj.frameRate||24,e.type){case"vobj":this.video=e.vobj;break;default:this.video=document.getElementById(this.obj.id)||document.getElementsByTagName("video")[0]}};g.prototype={get:function(){return Math.floor(this.video.currentTime.toFixed(5)*this.frameRate)},listen:function(t,e){var a=this;t?this.interval=setInterval(function(){if(!a.video.paused&&!a.video.ended){var e="SMPTE"===t?a.toSMPTE():"time"===t?a.toTime():a.get();return a.obj.callback&&a.obj.callback(e,t),e}},e||1e3/a.frameRate/2):console.log("VideoFrame: Error - The listen method requires the format parameter.")},stopListen:function(){clearInterval(this.interval)},fps:Strack.G.FrameRates},g.prototype.toTime=function(e){var t="number"!=typeof e?this.video.currentTime:e,a=this.frameRate,i=new Date,s="hh:mm:ss"+("number"==typeof e?":ff":"");function l(e){return e<10?"0"+e:e}return i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(1e3*t),s.replace(/hh|mm|ss|ff/g,function(e){switch(e){case"hh":return l(i.getHours()<13?i.getHours():i.getHours()-12);case"mm":return l(i.getMinutes());case"ss":return l(i.getSeconds());case"ff":return l(Math.floor(t%1*a))}})},g.prototype.toSMPTE=function(e){if(!e)return this.toTime(this.video.currentTime);var t=Number(e),a=this.frameRate;function i(e){return e<10?"0"+e:e}var s=60*a,l=(t/(60*a*60)).toFixed(0),n=Number((t/s).toString().split(".")[0])%60,r=Number((t/a).toString().split(".")[0])%60;return i(l)+":"+i(n)+":"+i(r)+":"+i(t%a)},g.prototype.toSeconds=function(e){if(!e)return Math.floor(this.video.currentTime);var t=e.split(":");return 60*Number(t[0])*60+60*Number(t[1])+Number(t[2])},g.prototype.toMilliseconds=function(e){var t=e?Number(e.split(":")[3]):Number(this.toSMPTE().split(":")[3]),a=1e3/this.frameRate*(isNaN(t)?0:t);return Math.floor(1e3*this.toSeconds(e)+a)},g.prototype.toFrames=function(e){var t=e?e.split(":"):this.toSMPTE().split(":"),a=this.frameRate,i=60*Number(t[0])*60*a,s=60*Number(t[1])*a,l=Number(t[2])*a,n=Number(t[3]);return Math.floor(i+s+l+n)},g.prototype.__seek=function(e,t){this.video.paused||this.video.pause();var a=Number(this.get());this.video.currentTime=("backward"===e?a-t:a+t)/this.frameRate+1e-5},g.prototype.seekForward=function(e,t){return e||(e=1),console.log(Number(e)),this.__seek("forward",Number(e)),!t||t()},g.prototype.seekBackward=function(e,t){return e||(e=1),this.__seek("backward",Number(e)),!t||t()},g.prototype.seekTo=function(e){var t,a,i=e||{},s=Object.keys(i)[0];if("SMPTE"===s||"time"===s)return a=i[s],t=this.toMilliseconds(a)/1e3+.001,void(this.video.currentTime=t);switch(s){case"frame":a=this.toSMPTE(i[s]),t=this.toMilliseconds(a)/1e3+.001;break;case"seconds":t=Number(i[s]);break;case"milliseconds":t=Number(i[s])/1e3+.001}isNaN(t)||(this.video.currentTime=t)},obj={toggle_playlist_tab:function(e){if(N(!0)){var t=$(e).data("tab");switch(de(),t){case"task":me(t,"my_review",!1);break;case"playlist":me(t,"my_create",!1)}}},toggle_playlist_inside_tab:function(e){if(N(!0)){var t=$(e).data("tab");$("#playlist_inside_my_create,#playlist_inside_all_playlist,#playlist_inside_follow").empty(),de(),pe(t,!1)}},toggle_info_tab:function(e){N(!0)&&ue($(e).data("tab"),$(e).html())},hidden_panel:function(e){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{var t=$(e).data("pos"),a=$("#st_media_left"),i=($("#st_media_mid"),$("#st_media_right"));switch(t){case"left":N(!0)&&(a.addClass("hidden").hide(),$("#show_bnt_left").addClass("bnt-active"),M());break;case"right":i.addClass("hidden").hide(),$("#show_bnt_right").addClass("bnt-active"),M()}A(t,"show")}},show_panel:function(e){var t=$(e).data("pos"),a=$("#st_media_left"),i=($("#st_media_mid"),$("#st_media_right"));switch(t){case"left":a.removeClass("hidden"),$("#show_bnt_left").removeClass("bnt-active"),M();break;case"right":i.removeClass("hidden"),$("#show_bnt_right").removeClass("bnt-active"),M()}A(t,"hidden")},show_file_grid_panel:function(e){F(e)},toggle_track:function(e){var t=$(e).data("pos"),a=$(".media-player"),i=$(".media-file-grid"),s=$(".file-toolbar"),l=$(".media-player-bottom"),n=$(e).find("i");switch(i.css("height","50px"),s.hide(),t){case"top":$(e).data("pos","bottom"),a.css("height","calc(100% - 59px)"),l.css("height","51px"),n.removeClass("icon-uniE76B").addClass("icon-uniE76C");break;case"bottom":$(e).data("pos","top"),a.css("height","calc(100% - 348px)"),l.css("height","340px"),n.removeClass("icon-uniE76C").addClass("icon-uniE76B")}},playlist_follow:function(e){var t=$(e).data("id"),a=$(e).attr("data-follow"),i="unfollow"===a?"no":"yes";$(e).closest(".play-list-items").hasClass("selected")&&z(i),B(t,a),he(t,a,"item")},timeline_playlist_follow:function(e){var t=$("#timeline_entity_id").val(),a=$(e).attr("data-follow");z("unfollow"===a?"no":"yes"),B(t,a),he(t,a,"timeline")},save_timeline_change:function(e){Strack.G.mediaScreenshotStatus?layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6}):ce({mode:"timeline",id:$("#timeline_entity_id").val()})},reload_timeline:function(e){Strack.G.mediaScreenshotStatus?layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6}):W()},player_control:function(e){switch($(e).data("bnt")){case"play":ee();break;case"metadata":ne();break;case"fullscreen":!function(){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{var e=$("#m_controller_fullscreen"),t=e.data("active");switch(window.fullScreenApi.supportsFullScreen&&(window.fullScreenApi.isFullScreen()?window.fullScreenApi.cancelFullScreen():window.fullScreenApi.requestFullScreen(document.getElementById("st_media_mid"))),t){case"on":e.data("active","off"),e.html('<i class="icon-uniE9B4"></i>');break;case"off":e.data("active","on"),e.html('<i class="icon-uniE9B5"></i>')}}}();break;case"painter":le();break;case"loop":!function(){var e=$("#m_controller_loop");switch(e.data("loop")){case"all_loop":e.data("loop","once"),e.html('<i class="icon-uniF178"></i>'),x="once";break;case"once":e.data("loop","self_loop"),e.html('<i class="icon-uF0030"></i>'),x="self_loop";break;case"self_loop":e.data("loop","all_loop"),e.html('<i class="icon-uniEA56"></i>'),x="all_loop"}}();break;case"voice":!function(){var e=$("#m_controller_voice");switch(e.data("voice")){case"on":e.data("voice","off"),e.html('<i class="icon-uniEA53"></i>'),j.volume=0,E=0;break;case"off":e.data("voice","on"),e.html('<i class="icon-uniEA50"></i>'),j.volume=1,E=1}}()}},exit_media_painter:function(){le()},add_playlist:function(e){u("add_playlist"),O("add")},playlist_edit:function(e){var t=$(e).data("id");u("modify_playlist"),O("modify",t)},playlist_delete:function(e){var t,a,i=$(e).data("id"),s=$(e).closest(".play-list-items").hasClass("selected");t=i,a=s,$.ajax({type:"POST",url:MediaPHP.deleteReviewPlaylist,data:{entity_id:t},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),a?pe(l.tab):ye(l.dom_id,l,!1)):layer.msg(e.message,{icon:7,time:1200,anim:6})}})},add_file_to_timeline:function(e){!function(){var t=$("#main_datagrid_box"),e=t.datagrid("getSelections");if(0<e.length){var a=[];e.forEach(function(e){a.push(e.id)}),$.ajax({type:"POST",url:MediaPHP.getTimeLineFileCommitData,data:{primary_ids:a.join(",")},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){U(e.rows),V(),t.datagrid("clearSelections"),$.messager.progress("close")}})}else layer.msg(StrackLang.Please_Select_One,{icon:2,time:1200,anim:6})}()},delete_track_item:function(e){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{$(e).data("id");var t=$(e).data("uuid");$("#track_item_"+t).remove(),function(e){var t={};for(var a in r)a!==e&&(t[a]=r[a]);r=t}(t),oe()}},select_playlist:function(e){var t=$(e).data("id"),a=$(e).data("urltag");$(".play-list-items").removeClass("selected"),$(e).closest(".play-list-items").addClass("selected"),$e("playlist",a),u("playlist_selected"),D(t,"select")},save_playlist:function(e){ce({mode:$(e).data("mode"),id:$(e).data("id")})},select_track_item:function(e){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{var t=$(e).closest(".track-item");if(t.hasClass("load-active")){var a=t.data("uuid"),i=0;for(var s in C)C[s].uuid_md5===a&&(i=s);l=i,ae(),J(l)}else layer.msg(StrackLang.Media_Not_Loaded,{icon:2,time:1200,anim:6})}var l},search_left_panel:function(){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{var e=$(".playlist-tab.active").data("tab"),t=$("#left_search_val").val();0<t.length?l.filter={name:["-lk","%"+t+"%"]}:l.filter="",l.status="new";var a=$(".playlist-inside-tab.active").data("tab");switch(e){case"task":switch($e(e,"scene=review_task"),u("review_task"),a){case"my_review":ye("#playlist_inside_my_review",l,!1);break;case"all_task":ye("#playlist_inside_all_task",l,!1)}break;case"playlist":switch($e(e,"scene=playlist"),u("playlist"),a){case"my_create":ge("#playlist_inside_my_create",l,!1);break;case"all_playlist":ge("#playlist_inside_all_playlist",l,!1);break;case"follow":ve("#playlist_inside_follow",l,!1)}}}},select_review_task:function(e){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{var t=$(e).data("id"),a=$(e).data("urltag");$(".play-list-items").removeClass("selected"),$(e).closest(".play-list-items").addClass("selected"),$e("review_task",a),u("review_task_selected"),G(t),_=t,ue("note",StrackLang.Feedback)}},delete_review_task:function(e){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{var t=$(e).data("id"),a=$(e).closest(".play-list-items").hasClass("selected");i=t,s=a,$.ajax({type:"POST",url:MediaPHP.deleteReviewTask,data:{base_id:i},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close"),200===parseInt(e.status)?(Strack.top_message({bg:"g",msg:e.message}),s?pe(l.tab,!1):ye(l.dom_id,l,!1)):layer.msg(e.message,{icon:7,time:1200,anim:6})}})}var i,s},media_edit:function(e){var t=$(e).data("lang");Strack.get_datagrid_select_data("#main_datagrid_box",function(e){Strack.item_operate_dialog(t,{mode:"modify",field_list_type:["edit"],module_id:m.module_id,project_id:m.project_id,page:m.page,type:"update_panel",primary_id:e.join(",")},function(){obj.reset_media_grid()})})},media_delete:function(e){Strack.ajax_grid_delete("main_datagrid_box","id",StrackLang.Delete_File_Commit_Notice,MediaPHP.deleteFileCommit)},reset_media_grid:function(){$("#main_datagrid_box").datagrid("reload")},close_review_task_details:function(e){var t=$("#review_entity_step_task"),a=t.find(".etask-l-active"),i=!0;if(0<a.length){var s=a.attr("id"),l=a.attr("data-stepcode"),n=Strack.check_item_operate_fields("m_review_task_fields","m_review_task_item");Strack.G.entityStepTaskAddData.data[l][s]=n.up_data,n.allow_up?a.addClass("form_ok"):i=!1}i&&($("#step_task_details").hide(),t.find(".stdg-etask-l-item").removeClass("etask-l-active"))},close_review_add_playlist:function(e){$.messager.confirm(StrackLang.Confirmation_Box,StrackLang.Close_Add_Playlist_Notice,function(e){e&&(Strack.G.entityStepTaskAddData.data={},$(".add-review-entity,#step_task_details").hide(),$(".st-media-search,.media-review-list").show(),u("playlist"))})},remove_screenshot:function(e){$(e).closest(".pyn-st-img").remove();var t=$("#screenshot_list");0===t.find(".pyn-st-img").length&&t.html('<div class="pyn-st-null">'+StrackLang.Screenshot_Null+"</div>")}};var m=Strack.generate_hidden_param();m.grid_page_id=m.module_code+"_grid_"+m.project_id;var f,v,h,y,b,k,w,S,t,a,i,s,l=m,n=l.filter="",r={},C={},c={},j=null,P=null,o=null,T=!0,d=0,_=0,E=1,x="all_loop",L=$("#media_view_slider");M(),$("#st_media_wrap").on("mresize",function(e){N(!1)&&M()}),$("#media_player_view").on("mresize",function(e){Se()}),$(document).on("keydown",function(e){var t;switch(t=e,0<=$.inArray(t.keyCode,[32,37,39])&&(t.stopPropagation(),t.preventDefault()),e.keyCode){case 32:ee();break;case 37:te("back");break;case 39:te("forward");break;case 70:Se();break;case 73:"yes"===m.rule_web_player_metadata&&ne();break;case 86:"yes"===m.rule_review&&"yes"===m.rule_web_player_painter&&le();break;case 13:$("#left_search_val").is(":focus")&&obj.search_left_panel(Strack.get_obj_by_id("left_search_bnt"))}}),i=$(".media-player"),s=$(".media-player-bottom"),$(".center-handle").on("mousedown",function(e){e.preventDefault(),t=document.body.clientHeight-110,$("#st_media_mid").on("mousemove",function(e){(a=document.body.clientHeight-e.pageY)<t&&51<=a&&(i.css("height","calc(100% - "+(a+8)+"px)"),s.css("height",a+"px"))}).on("mouseup",function(e){$(this).off("mousemove")})}),$("#video_paint").wPaint({menuDom:"#paint_menu",menuOrientation:"vertical",imageBg:StrackPHP.PUBLIC+"/images/screenshot.png"});var p={url_scene:m.url_scene,url_tab:m.url_tab,url_id:m.url_id,url_item_name:m.url_item_name};function u(e){var t=$("#timeline_playlist_follow"),a=$("#timeline_playlist_save"),i=$("#media_player_disabled"),s=$("#preview_painter_bnt"),l=$("#save_playlist_bnt span"),n=$("#add_playlist_title"),r=$("#st_media_left"),o=$("#st_media_right"),d=$("#st_media_mid"),c=$("#show_bnt_left"),_=$("#show_bnt_right");switch(e){case"playlist":q(),i.show(),t.show(),a.show(),s.hide(),obj.hidden_panel(Strack.get_obj_by_id("top_bnt_right")),F(Strack.get_obj_by_id("grid_button_center"),"bottom"),obj.show_panel(Strack.get_obj_by_id("grid_button_left")),A("right","hidden"),A("center","hidden");break;case"playlist_selected":q(),i.hide(),t.show(),a.show(),s.hide(),F(Strack.get_obj_by_id("grid_button_center"),"bottom"),A("right","hidden"),A("center","show");break;case"add_playlist":case"modify_playlist":q(),$(".st-media-search,.media-review-list").hide(),$(".add-review-entity").show(),"add_playlist"===e?(l.html(StrackLang.Submit_Add_Playlist),n.html(StrackLang.Add_Playlist)):(l.html(StrackLang.Submit_Modify_Playlist),n.html(StrackLang.Modify_Playlist)),i.hide(),t.hide(),a.hide(),F(Strack.get_obj_by_id("grid_button_center"),"top"),A("center","show");break;case"review_task":console.log(m.rule_palylist),q(),i.show(),t.hide(),a.show(),s.show(),obj.hidden_panel(Strack.get_obj_by_id("top_bnt_right")),F(Strack.get_obj_by_id("grid_button_center"),"bottom"),obj.show_panel(Strack.get_obj_by_id("grid_button_left")),A("right","hidden"),A("center","hidden");break;case"review_task_selected":q(),$("#screenshot_list").html('<div class="pyn-st-null">'+StrackLang.Screenshot_Null+"</div>"),i.hide(),t.hide(),a.show(),s.show(),obj.show_panel(Strack.get_obj_by_id("grid_button_right")),F(Strack.get_obj_by_id("grid_button_center"),"bottom"),A("right","show"),A("center","show");break;case"review_task_no_left":i.hide(),r.addClass("hidden"),c.hide(),d.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-81").removeClass("gird-mid-full").addClass("gird-mid-75"),o.show();break;case"review_task_no_side":case"playlist_no_side":i.hide(),r.addClass("hidden"),o.addClass("hidden"),c.hide(),_.hide(),d.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-75").removeClass("gird-mid-81").addClass("gird-mid-full")}}function F(t,e){var a=$(t).data("pos"),i=$("#file_grid_panel"),l=$(".media-file-grid"),n=$(".file-toolbar"),r=$(t).closest(".media-file-grid-bnt"),o=$(".media-player-bottom");switch(e||a){case"top":ae(),$(t).data("pos","bottom"),i.slideDown(100,"linear",function(){var s;$(t).find("i").removeClass("icon-uniF103").addClass("icon-uniF102"),r.removeClass("grid-bnt-top").addClass("grid-bnt-bottom"),n.show(),(s=$("#main_datagrid_box")).hasClass("datagrid-f")?s.datagrid("reload"):Strack.load_grid_columns("#grid_datagrid_main",{loading_id:"#file_grid_panel",loading_type:"black",page:m.page,module_id:m.module_id,project_id:m.project_id,view_type:"grid",temp_fields:{add:{},cut:{}}},function(e){var t={filter:{temp_fields:{add:{},cut:{}},group:e.grid.group_name,sort:e.grid.sort_config.sort_query,request:[],filter_input:e.grid.filter_config.filter_input,filter_panel:e.grid.filter_config.filter_panel,filter_advance:e.grid.filter_config.filter_advance},page:m.page,module_id:m.module_id,project_id:m.project_id},a=$(".media-player-bottom").height()-53;a=51<a?a:49;var i={url:MediaPHP.getMediaGridData,height:Strack.panel_height("#file_grid_panel",0),view:scrollview,rowheight:50,differhigh:!1,singleSelect:!1,adaptive:{dom:".media-file-grid,.datagrid-filter",min_width:680,exth:a+36,domresize:1},multiSort:!0,DragSelect:!0,moduleId:m.module_id,queryParams:{filter_data:JSON.stringify(t)},panelConfig:{active_filter_id:e.grid.filter_config.filter_id},sortConfig:e.grid.sort_config,sortData:e.grid.sort_config.sort_data,toolbarConfig:{id:"grid_datagrid_main",page:"project_base",sortAllow:!0,groupAllow:!0,fieldAllow:!0,viewAllow:!0,actionAllow:!0},searchConfig:{id:"main_grid_search",bar_show:e.filter_bar_show,filterBar:{main_dom:"grid_datagrid_main",bar_dom:"grid_filter_main"}},filterConfig:{id:"grid_filter_main",loading_type:null,barParam:{}},columnsFieldConfig:e.grid.columnsFieldConfig,frozenColumns:e.grid.frozenColumns,columns:e.grid.columns,toolbar:"#tb_grid",pagination:!0,pageNumber:1,pageSize:100,pageList:[100,150],pagePosition:"bottom",showPageList:!1,remoteSort:!1,onDblClickRow:function(e,t){}};e.grid.group_name.length&&(i.groupActive=!0,i.groupField=e.grid.group_name,i.groupFormatter=function(e,t){return'<span class="">'+e+"( "+t.length+" )</span>"}),s.datagrid(i).datagrid("enableCellEditing").datagrid("disableCellSelecting").datagrid("gotoCell",{index:0,field:"id"}).datagrid("columnMoving")}),obj.hidden_panel(Strack.get_obj_by_id("top_bnt_right"));var e=o.height()-102;e=0<=e?e:0,l.css("height","calc(100% - "+e+"px)")});break;case"bottom":$(t).data("pos","top"),n.hide(),l.css("height","50px"),r.removeClass("grid-bnt-bottom").addClass("grid-bnt-top"),i.slideUp(100,"linear",function(){$(t).find("i").removeClass("icon-uniF102").addClass("icon-uniF103")})}}function A(e,t){switch(e){case"center":var a=$("#grid_button_center");switch(t){case"show":a.show();break;case"hidden":a.hide()}break;case"left":var i=$("#show_bnt_left");switch(t){case"show":i.show();break;case"hidden":i.hide()}break;case"right":var s=$("#show_bnt_right");switch(t){case"show":"task"===n&&s.show();break;case"hidden":s.hide()}}}function M(){var e=$("#st_media_left"),t=$("#st_media_right"),a=$("#st_media_wrap"),i=$("#st_media_mid"),s=e.width(),l=0,n=a.width(),r=e.is(":hidden"),o=t.is(":hidden"),d=e.hasClass("hidden"),c=t.hasClass("hidden");d||c||(r||o||s<=330&&(e.hide(),i.removeClass("nine").removeClass("gird-mid-56").addClass("gird-mid-75")),l=t.width(),r=e.is(":hidden"),o=t.is(":hidden"),r&&!o&&(l<=420&&(t.hide(),i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-75").removeClass("gird-mid-81").addClass("gird-mid-full")),330<.1875*n&&(i.removeClass("nine").addClass("gird-mid-full").removeClass("gird-mid-81").removeClass("gird-mid-75").addClass("gird-mid-56"),e.show(),t.show())),!r&&o&&330<.1875*n&&(i.removeClass("nine").addClass("gird-mid-full").removeClass("gird-mid-81").removeClass("gird-mid-75").addClass("gird-mid-56"),e.show(),t.show()),r&&o&&(420<.25*n&&(i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-81").removeClass("gird-mid-full").addClass("gird-mid-75"),t.show()),330<.1875*n&&(i.removeClass("nine").removeClass("gird-mid-75").removeClass("gird-mid-81").removeClass("gird-mid-full").addClass("gird-mid-56"),e.show(),t.show()))),d&&c&&i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-75").removeClass("gird-mid-81").addClass("gird-mid-full"),d&&!c&&(420<.25*n?(t.show(),i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-81").removeClass("gird-mid-full").addClass("gird-mid-75")):(t.hide(),i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-75").removeClass("gird-mid-81").addClass("gird-mid-full"))),!d&&c&&(330<.1875*n?(e.show(),i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-81").removeClass("gird-mid-full").addClass("gird-mid-81")):(e.hide(),i.removeClass("nine").removeClass("gird-mid-56").removeClass("gird-mid-75").removeClass("gird-mid-81").addClass("gird-mid-full")))}function N(e){return!$(".add-review-entity").is(":visible")||(e&&layer.msg(StrackLang.Close_Add_Playlist_Panel_First,{icon:2,time:1200,anim:6}),!1)}function O(t,e){"add"===t?R(t):($.ajax({url:MediaPHP.getPlayEntityInfo,type:"POST",dataType:"json",data:{entity_id:e},beforeSend:function(){$("#st_media_left").append(Strack.loading_dom("black","","edit_playlist"))},success:function(e){I({entity_id:e.id,entity_name:e.name},"modify"),R(t,e),$("#st-load_edit_playlist").remove()}}),D(e,"edit_playlist"))}function R(e,t){$("#review_entity_step_task").empty().append('<div class="datagrid-empty-no">'+StrackLang.Please_Select_Step+"</div>"),"modify"===e?($("#review_entity_name").val(t.name),$("#review_entity_code").val(t.code)):$("#review_entity_name,#review_entity_code").val("");var a=$("#review_entity_status");if(a.hasClass("combobox-f"))a.combobox("clear"),a.combobox("setValue",t.status_id);else{var i=t?t.status_id:"";Strack.combobox_widget("#review_entity_status",{url:StrackPHP.getReviewStatusCombobox,prompt:StrackLang.Select_One_Status,queryParams:m,valueField:"id",textField:"name",width:"100%",height:30,value:i})}var s={step_id:"review_entity_step",list_id:"review_entity_step_task",combox_id:"m_review_task_fields",edit_id:"m_review_task_item"},l=$("#review_entity_step");l.hasClass("combobox-f")?(l.combobox("clear"),H(s,t)):Strack.combobox_widget("#review_entity_step",{url:StrackPHP.getReviewStepConfig,prompt:StrackLang.Select_Step,queryParams:m,multiple:!0,valueField:"id",textField:"name",width:"100%",height:30,onSelect:function(e){e&&Strack.add_entity_step_task_group(s,e,"new")},onUnselect:function(e){Strack.remove_entity_step_task_group(s,e)},onLoadSuccess:function(){H(s,t)}})}function H(e,t){var l,a,i=[],s=$("#review_entity_step");if(t){var n,r=[],o={};for(var d in Strack.G.entityStepTaskAddData.data=t.step_data,t.step_data)for(var c in r.push(t.step_config[d].id),o.id=t.step_config[d].id,o.step_code=t.step_config[d].code,o.step_name=t.step_config[d].name,t.step_data[d])o.code=c,n||(n=t.step_data[d][c]),Strack.add_entity_step_task_group(e,o,"old");for(var _ in i=[],n)n[_].forEach(function(e){i.push(e.field)});s.combobox("setValues",r)}l=i,a={mode:"create",field_list_type:["edit"],module_id:m.task_module_id,project_id:m.project_id,page:m.page,type:"add_entity_task_panel"},Strack.get_item_fields(a,function(a){var t=[];for(var i in a.field_list)for(var s in a.field_list[i])a.field_list[i][s].fields.forEach(function(e){e.field_group_name=a.field_list[i][s].title,e.project_id=m.project_id,e.module_id=m.module_id,e.frozen_module=e.frozen_module,e.flg_module=e.flg_module,e.fields=e.module+"-"+e.id,t.push(e)});$("#m_review_task_fields").combobox({data:t,width:350,valueField:"fields",textField:"lang",groupField:"field_group_name",multiple:!0,value:"",onSelect:function(e){if(0===$("#dgup_i_"+e.fields).length){var t=Strack.field_item_dom(e,m);if($("#m_review_task_item").append(t.item_dom),Strack.field_item_init(t.dom_id,m.project_id,e),"name"===e.id||"code"===e.id){var a=$("#stdg_etask_list .etask-l-active").find(".etask-l-item-name").html();$("#"+t.dom_id).val(a)}}},onUnselect:function(e){$("#dgup_i_"+e.fields).remove()},onLoadSuccess:function(){var t=$(this);l?l.forEach(function(e){t.combobox("select",e)}):a.user_setting.forEach(function(e){t.combobox("select",e)})},onChange:function(e,t){$(".stdg-etask-l-item").removeClass("form_ok")}})})}function D(e,t){$.ajax({type:"POST",url:MediaPHP.getPlaylistTimeLineData,data:JSON.stringify({entity_id:e,entity_param:m}),dataType:"json",contentType:"application/json",beforeSend:function(){q(),$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){"edit_playlist"!==t&&I(e,"timeline"),U(e.rows),V(),$.messager.progress("close"),"edit_playlist"!==t&&W()}})}function G(e){$.ajax({type:"POST",url:MediaPHP.getReviewTaskTimeLineData,data:JSON.stringify({base_id:e,entity_param:m}),dataType:"json",contentType:"application/json",beforeSend:function(){q(),$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){I(e,"timeline"),U(e.rows),V(),$.messager.progress("close"),W()}})}function I(e,t){$(".timeline-playlist-name").html(e.entity_name),$("#timeline_entity_id").val(e.entity_id),$("#save_playlist_bnt").attr("data-mode",t).attr("data-id",e.entity_id),z(e.is_follow)}function z(e){var t=$("#timeline_playlist_follow");"yes"===e?(t.html(StrackLang.UnFollow),t.attr("data-follow","unfollow")):(t.html(StrackLang.Follow),t.attr("data-follow","follow"))}function B(e,t){var a=$("#playlist_item_"+e).find("a.second");switch(t){case"unfollow":a.attr("data-follow","follow"),a.html('<i class="icon-uniEA00"></i>');break;case"follow":a.attr("data-follow","unfollow"),a.html('<i class="icon-uniEA02"></i>')}}function U(e){var t=$("#timeline_track .datagrid-empty-no");0<t.length&&t.remove(),e.forEach(function(e){var t,a,i,s;t=e,$("#timeline_track").prepend((i="",i+='<li class="text-no-select"><div id="track_item_'+(a=t).uuid_md5+'" class="track-item not-load aign-left" data-id="'+a.id+'" data-uuid="'+a.uuid_md5+'"><div class="item-header"><div class="triangle"></div><div class="version">'+a.version+'</div><a href="javascript:;" class="delete" onclick="obj.delete_track_item(this)" data-id="'+a.id+'" data-uuid="'+a.uuid_md5+'"><i class="icon-uniE6DF"></i></a></div><a href="javascript:;"  class="main" onclick="obj.select_track_item(this)" data-id="'+a.id+'" data-uuid="'+a.uuid_md5+'"><div class="item-thumb"><img src="'+a.thumb+'"></div><div class="item-bottom"><div class="parent text-ellipsis">'+a.task_name+'</div><div class="name text-ellipsis">'+a.name+"</div></div></a></div></li>")),r[(s=e).uuid_md5]=s}),oe()}function V(){"yes"===m.rule_web_player_drag&&Sortable.create(Strack.get_obj_by_id("timeline_track"),{filter:".triangle,.delete"})}function q(){var e,t;ae(),f&&($("#video_main").empty(),cancelAnimationFrame(w),e=$("#m_controller_painter"),t=$(".left-paint"),$("#vp_canvas_wrap").hide(),e.data("active","off"),e.removeClass("mc-active"),t.hide(),L.slider("enable")),$(".timeline-playlist-name").html(StrackLang.Playlist_Name),$("#timeline_entity_id").val(""),$("#save_playlist_bnt").attr("data-mode","add").attr("data-id","0").find("span").html(StrackLang.Save_Timeline),$("#timeline_track").empty(),r={},C={}}function W(){var t,e=$("#timeline_track").find(".track-item");0<e.length?(ae(),C={},e.each(function(e){t=$(this).data("uuid"),$(this).removeClass("not-load").addClass("load-active"),r[t]&&(C[e]=r[t])}),J(0)):layer.msg(StrackLang.Timeline_Is_Empty,{icon:2,time:1200,anim:6})}function J(e){var t=C[S=e];!function(e){if("yes"===m.rule_web_player_metadata){var t="",a="";e.forEach(function(e){t+='<li class="meta-title">'+e.lang+"</li>",a+='<li class="meta-show">'+e.value+"</li>"}),$("#metadata_name").empty().append(t),$("#metadata_show").empty().append(a)}}(t.task_info),$(".track-item").removeClass("item-active"),"yes"===t.media_data.has_media?($("#track_item_"+t.uuid_md5).addClass("item-active"),function(e,t){var a=$("#video_main");f&&(a.empty(),cancelAnimationFrame(w));switch(j=null,t.type){case"image":(j=document.createElement("img")).src=t.base_url+"/"+t.md5_name+"_origin."+t.ext;break;case"video":(j=document.createElement("video")).src=t.base_url+"/"+t.md5_name+"."+t.ext,P=g({vobj:j,type:"vobj",frameRate:t.rate})}j.setAttribute("crossOrigin","anonymous"),j.width=t.width,j.height=t.height;var i=new THREE.Texture(j);i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.format=THREE.RGBFormat;var s=new THREE.MeshLambertMaterial({map:i,side:THREE.FrontSide}),l=a.width(),n=a.height(),r=l/n,o=t.width/t.height,d=0,c=0;c=r<o?(d=l)/o:(d=n*o,n);T?(v=new THREE.WebGLRenderer({antialias:!0}),h=new THREE.PerspectiveCamera(90,l/n,.1,1e4),(f=new THREE.Scene).add(h),h.position.z=n/2,v.setSize(l,n),document.getElementById("video_main").appendChild(v.domElement),y=new THREE.AmbientLight(16777215),f.add(y),b=new THREE.TrackballControls(h,v.domElement),(k=new THREE.Mesh(new THREE.PlaneGeometry(d,c),s)).name="main_version",f.add(k)):(v.setSize(l,n),document.getElementById("video_main").appendChild(v.domElement),h.aspect=l/n,h.position.z=n/2,h.updateProjectionMatrix(),k.geometry.vertices[0].x="-"+d/2,k.geometry.vertices[0].y=c/2,k.geometry.vertices[1].x=d/2,k.geometry.vertices[1].y=c/2,k.geometry.vertices[2].x="-"+d/2,k.geometry.vertices[2].y="-"+c/2,k.geometry.vertices[3].x=d/2,k.geometry.vertices[3].y="-"+c/2,k.geometry.verticesNeedUpdate=!0,k.material=s,k.material.needsUpdate=!0);switch(p=e,C[p].position&&(h.position.z=C[p].position.camera_zoom,h.position.x=C[p].position.camera_x,h.position.y=C[p].position.camera_y,b.target.x=C[p].position.camera_x,b.target.y=C[p].position.camera_y,h.updateProjectionMatrix(),k.position.set(C[p].position.plane_x,C[p].position.plane_y,0)),function e(){b.update(),u(),w=requestAnimationFrame(e)}(),t.type){case"image":K(t,1);break;case"video":_=t,m=0,j.load(),j.volume=E,ie("pause"),j.addEventListener("loadedmetadata",function(){j.play(),m=Strack.time_to_frame(this.duration,_.rate),se(_,m)}),j.addEventListener("timeupdate",function(){var e=Strack.time_to_frame(this.currentTime);L.slider("setValue",e),re(e,m)}),j.addEventListener("ended",function(){Y(S),"self_loop"===x?J(S):Q(_)})}var _,m;var p;function u(){switch(t.type){case"image":j.complete&&(i.needsUpdate=!0);break;case"video":j.readyState===j.HAVE_ENOUGH_DATA&&(i.needsUpdate=!0)}v.clear(),v.render(f,h),T=!1}}(e,t.media_data.param)):layer.msg(StrackLang.Media_Data_Not_Exist,{icon:2,time:1200,anim:6})}function Y(e){C[e].position={camera_x:h.position.x,camera_y:h.position.y,plane_x:k.position.x,plane_y:k.position.y,camera_zoom:h.position.z}}function K(e,t){var a=1e3/Strack.G.FrameRates.film;ie("pause"),se(e,72),o=setInterval(function(){t++,L.slider("setValue",t),re(t,72),72===t&&(Y(S),"self_loop"===x?t=1:(Z(),Q(e)))},a)}function Q(e){var t=0,a=!1;parseInt(S)<Object.keys(C).length-1?t=parseInt(S)+1:a=!(t=0),"once"!==x||"once"===x&&!a?J(t):(ae(),ie("play"))}function X(){j&&(j.pause(),ie("play"))}function Z(){o&&(window.clearInterval(o),o=null,ie("play"))}function ee(e){if(j){var t=e||$("#m_controller_player").data("status"),a=C[S].media_data.param;switch(a.type){case"image":"play"===t?Z():K(a,L.slider("getValue"));break;case"video":"play"===t?X():j&&(j.play(),ie("pause"))}Strack.G.mediaScreenshotStatus&&le()}}function te(e){if(!$.isEmptyObject(C))switch(C[S].media_data.param.type){case"image":Z();var t=parseInt(L.slider("getValue")),a=0;a="back"===e?1<t?t-1:1:t+1,L.slider("setValue",a),re(a,72);break;case"video":X(),"back"===e?P.seekBackward(1):P.seekForward(1)}}function ae(){if(!$.isEmptyObject(C))switch(C[S].media_data.param.type){case"image":Z();break;case"video":X()}}function ie(e){var t=$("#m_controller_player");switch(e||t.data("status")){case"pause":t.data("status","play"),t.html('<i class="icon-uniEA46"></i>');break;case"play":t.data("status","pause"),t.html('<i class="icon-uniEA45"></i>')}}function se(a,i){L.hasClass("load-ac")?L.slider("setOptions",{max:i}):(L.find(".default-show").remove(),L.addClass("load-ac"),L.slider({mode:"h",min:1,max:i,height:14,step:1,progressbar:!0,onComplete:function(e){if(e<i){var t=(e/a.rate).toFixed(2);"video"===a.type&&(j.currentTime=t)}}}))}function le(){if(f){var e=$("#m_controller_painter"),t=e.data("active"),a=$(".left-paint"),i=$(".media-file-grid");switch(t){case"on":Strack.G.mediaScreenshotStatus=!1,e.data("active","off"),e.removeClass("mc-active"),a.hide(),L.slider("enable"),L.slider("setValue",d),function(){var e=$("#video_paint");$("#vp_canvas_wrap").hide(),e.wPaint("clearUndo");var t=e.wPaint("image");$(".pyn-st-null").remove(),$("#screenshot_list").append((a=t,i="",i+='<div class="pyn-st-img aign-left"><img src="'+a+'"><div class="frame">'+d+'</div><a href="javascript:;" class="pyn-st-delete" onclick="obj.remove_screenshot(this)"><i class="icon-uniE6DB"></i></a></div>'));var a,i}(),i.show();break;case"off":$("#screenshot_list .pyn-st-img").length+1<=20?(i.hide(),ee("play"),L.slider("disable"),d=L.slider("getValue"),e.data("active","on"),e.addClass("mc-active"),a.show(),s=$("#video_paint"),l=$("#video_main"),n=l.width(),r=l.height(),s.css({width:n,height:r}),$("#video_paint canvas").attr({width:n,height:r}),s.wPaint("imageBg",(v.render(f,h),v.domElement.toDataURL())),$("#vp_canvas_wrap").show(),Strack.G.mediaScreenshotStatus=!0):layer.msg(StrackLang.Only_Supports_Twenty_Screenshots,{icon:2,time:1200,anim:6})}}var s,l,n,r}function ne(){if(f){var e=$("#m_controller_metadata"),t=e.data("active");switch($("#media_metadata_wrap").toggle(),t){case"on":e.data("active","off"),e.removeClass("mc-active");break;case"off":e.data("active","on"),e.addClass("mc-active")}}}function re(e,t){var a="<span>"+Strack.prefix_integer(e,t.toString().length)+"</span> / <span>"+t+"</span>";$("#preview_frame").html(a)}function oe(){var e=$("#timeline_track"),t=200*e.find(".track-item").length;e.css("width",t)}function de(){$("#left_search_val").val(""),l.filter=""}function ce(e){var t=!0,a={},i={mode:e.mode,entity_param:m,entity_id:e.id,entity_data:{},step_ids:[],task_rows:{},file_commit_ids:[]};if(0<=$.inArray(e.mode,["add","modify"])){var s=Strack.validate_form("add_playlist_form");if(404===parseInt(s.status)?t=!1:i.entity_data=s.data,t)if($.isEmptyObject(Strack.G.entityStepTaskAddData.data))t=!1,layer.msg(StrackLang.Please_Select_Step,{icon:2,time:1200,anim:6});else{var l=$("#review_entity_step_task").find(".etask-l-active");if(0<l.length){var n=l.attr("id"),r=l.attr("data-stepcode"),o=Strack.check_item_operate_fields("m_review_task_fields","m_review_task_item");Strack.G.entityStepTaskAddData.data[r][n]=o.up_data,o.allow_up&&l.addClass("form_ok")}Strack.G.entityStepTaskAddData.status=!0,$(".stdg-etask-l-item").each(function(){$(this).hasClass("form_ok")||(Strack.G.entityStepTaskAddData.status=!1)}),Strack.G.entityStepTaskAddData.status?(i.task_rows=Strack.G.entityStepTaskAddData.data,i.step_ids=$("#review_entity_step").combobox("getRowValues","id")):(t=!1,layer.msg(StrackLang.Please_Fill_Step_Task_Data,{icon:2,time:1200,anim:6}))}t&&(a=_e(),i.file_commit_ids=a.file_commit_ids,t=a.allow_up)}else a=_e(),i.file_commit_ids=a.file_commit_ids,t=a.allow_up;t&&$.ajax({type:"POST",url:MediaPHP.savePlaylist,data:JSON.stringify(i),dataType:"json",contentType:"application/json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){console.log(e),$.messager.progress("close"),200===parseInt(e.status)?Strack.top_message({bg:"g",msg:e.message}):layer.msg(e.message,{icon:7,time:1200,anim:6})}})}function _e(){var e=$("#timeline_track").find(".track-item"),t=[],a=!0;if(0<e.length){var i=0;e.each(function(e){i=$(this).data("id"),t.push({id:i,index:e+1})})}else a=!1,layer.msg(StrackLang.Please_Add_FileCommit_To_Timeline,{icon:2,time:1200,anim:6});return{allow_up:a,file_commit_ids:t}}function me(e,t,a){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else{n=e,a||de(),$(".media-review-list .pitem-wrap").removeClass("active"),$(".playlist-tab").each(function(){$(this).data("tab")===e?$(this).addClass("active"):$(this).removeClass("active")}),$("#media_review_"+e).addClass("active");var i=$("#grid_button_left span");switch(e){case"task":i.html(StrackLang.Review_Task),pe(t,a);break;case"playlist":i.html(StrackLang.Playlist),pe(t,a)}}}function pe(e,t){if(Strack.G.mediaScreenshotStatus)layer.msg(StrackLang.On_Screenshot,{icon:2,time:1200,anim:6});else switch($(".inside-wrap-playlist").removeClass("active"),$(".playlist-inside-tab").each(function(){$(this).data("tab")===e?$(this).addClass("active"):$(this).removeClass("active")}),$("#playlist_inside_"+e).addClass("active"),l.status="new",l.page_number=1,l.page_size=100,l.tab=e){case"my_review":$e(e,"scene=task-my_review"),u("review_task"),l.type="my",ye(l.dom_id="#playlist_inside_my_review",l,t);break;case"all_task":$e(e,"scene=task-all_task"),u("review_task"),l.type="all",ye(l.dom_id="#playlist_inside_all_task",l,t);break;case"my_create":$e(e,"scene=playlist-my_create"),u("playlist"),l.type="my",ge(l.dom_id="#playlist_inside_my_create",l,t);break;case"all_playlist":$e(e,"scene=playlist-all_playlist"),u("playlist"),l.type="all",ge(l.dom_id="#playlist_inside_all_playlist",l,t);break;case"follow":$e(e,"scene=playlist-follow"),u("playlist"),ve("#playlist_inside_follow",l,t)}}function ue(e,t){switch($(".media-right-wrap .pitem-wrap").removeClass("active"),$(".media-info-tab").each(function(){$(this).data("tab")===e?$(this).addClass("active"):$(this).removeClass("active")}),$("#media_info_"+e).addClass("active"),$("#grid_button_right span").html(t),e){case"note":i=c[_],s={item_id:i.id,item_name:i.name,module_id:m.task_module_id,module_code:"base",module_type:"fixed",project_id:m.project_id,template_id:m.template_id,status:"new",page_number:1,page_size:10},Strack.load_notes({page_id:".st-media-wrap",content_id:"#media_info_note",avatar_id:"",editor_id:"comments_editor",list_id:"comments_list",tab_id:".info-tab",details_top_bar:!1,tab_bar_id:""},s);break;case"progress":$.ajax({type:"POST",url:MediaPHP.getReviewEntityProgress,data:{base_id:_},dataType:"json",beforeSend:function(){$("#st_media_right").prepend(Strack.loading_dom("black","","progress"))},success:function(e){$("#st-load_progress").remove(),function(e){var t,a="";for(var i in e)t="",0<e[i].list.length&&(e[i].list.forEach(function(e){t+=we(e)}),a+=ke(e[i].step_name,t));var s=$("#review_entity_progress");a?s.empty().append(a):s.html('<div class="etask-right-null"><div class="datagrid-empty-no">'+StrackLang.Datagird_No_Data+"</div></div>")}(e)}});break;case"details":a={category:"review_task",item_id:_,item_name:"",module_code:"base",module_id:m.task_module_id,module_type:"fixed",project_id:m.project_id,template_id:m.template_id},Strack.load_info_panel({id:"#media_base_info",mask:"media_base_info",pos:"review_task",url:MediaPHP.getReviewTaskInfoData,data:a,loading_type:"black"},function(e){var t=e.media_data;t.link_id=m.project_id,t.module_id=m.task_module_id,t.param.icon="icon-uniE61A",Strack.thumb_media_widget("#media_base_thumb",t)})}var a,i,s}function ge(a,i,s){$.ajax({type:"POST",url:MediaPHP.getReviewPlaylist,data:JSON.stringify(i),dataType:"json",contentType:"application/json",beforeSend:function(){$("#st_media_left").prepend(Strack.loading_dom("black","","all"))},success:function(e){var t=i.status;"new"===i.status&&(0<e.total&&$(a).empty(),i.status="more",i.total=e.total,Strack.fall_load_data(a,i,function(e){ge(a,i,s)})),fe(a,i,e.rows),"new"===t&&s&&p.select_id&&obj.select_playlist(Strack.get_obj_by_id(p.select_id)),$("#st-load_all").remove()}})}function fe(t,a,e){var i="pl_group_"+a.tab+"_",s="";e.forEach(function(e){s=i+e.group_md5,0===$("#"+s).length&&$(t).append(be(s,e)),$("#"+s).find(".plist-left-bar").append(function(e,t){var a="",i="scene=playlist-"+e+"-"+t.id,s="",l="";l="yes"===t.is_follow?(s="unfollow",'<i class="icon-uniEA02"></i>'):(s="follow",'<i class="icon-uniEA00"></i>');a+='<li id="playlist_item_'+t.id+'" class="play-list-items"><a id="item_playlist_'+t.id+'" href="javascript:;" class="choice" onclick="obj.select_playlist(this)"  data-id="'+t.id+'" data-urltag="'+i+'">'+function(e){for(var t="",a=e.length;a<4;a++)e[a]=StrackPHP.IMG+"/thumb_media_min.jpg";return t+='<div class="playlist-thumb aign-left"><div class="p-thumb-top"><div class="p-thumb-img" style="margin-right:2px"><img src="'+e[0]+'"></div><div class="p-thumb-img"><img src="'+e[1]+'"></div></div><div class="p-thumb-bottom"><div class="p-thumb-img" style="margin-right:2px"><img src="'+e[2]+'"></div><div class="p-thumb-img"><img src="'+e[3]+'"></div></div></div>'}(t.thumb)+'<div class="playlist-name aign-left"><div class="list-name-top text-ellipsis"><span class="list_createby">'+t.created_by+'</span></div><div class="list-name-bottom text-ellipsis">'+t.name+"</div></div></a>","yes"===m.rule_playlist_delete&&(a+='<a href="javascript:;" class="playlist-button first" onclick="obj.playlist_delete(this)" data-id="'+t.id+'"><i class="icon-uniE6DB"></i></a>');"yes"===m.rule_playlist_follow&&(a+='<a href="javascript:;" class="playlist-button second" onclick="obj.playlist_follow(this)" data-id="'+t.id+'" data-tab="'+e+'" data-follow="'+s+'">'+l+"</a>");"yes"===m.rule_playlist_modify&&(a+='<a href="javascript:;" class="playlist-button third" onclick="obj.playlist_edit(this)" data-id="'+t.id+'"><i class="icon-uniE684"></i></a>');return a+="</li>"}(a.tab,e))})}function ve(a,i,s){$.ajax({type:"POST",url:MediaPHP.getReviewFollowPlaylist,data:JSON.stringify(i),dataType:"json",contentType:"application/json",beforeSend:function(){$("#st_media_left").prepend(Strack.loading_dom("black","","follow"))},success:function(e){var t=i.status;"new"===i.status&&(0<e.total&&$(a).empty(),i.status="more",i.total=e.total,Strack.fall_load_data(a,i,function(e){ge(a,i,s)})),fe(a,i,e.rows),"new"===t&&s&&p.select_id&&obj.select_playlist(Strack.get_obj_by_id(p.select_id)),$("#st-load_follow").remove()}})}function he(e,t,a){$.ajax({type:"POST",url:MediaPHP.followReviewPlaylist,data:{entity_id:e,mode:t},dataType:"json",beforeSend:function(){$.messager.progress({title:StrackLang.Waiting,msg:StrackLang.loading})},success:function(e){$.messager.progress("close")}})}function ye(i,s,l){$.ajax({type:"POST",url:MediaPHP.getReviewTaskList,data:JSON.stringify(s),dataType:"json",contentType:"application/json",beforeSend:function(){$("#st_media_left").prepend(Strack.loading_dom("black","","all"))},success:function(e){var n,r,t,o,d,a=s.status;"new"===a&&(c={},$(i).empty(),0===parseInt(e.total)&&$(i).html('<div class="datagrid-empty-no">'+StrackLang.Datagird_No_Data+"</div>"),s.status="more",s.total=e.total,Strack.fall_load_data(i,s,function(e){ye(i,s,l)})),n=i,r=s,t=e.rows,o="pl_group_"+r.tab+"_",d="",t.forEach(function(e){var t,a,i,s,l;c[e.id]=e,d=o+e.group_md5,0===$("#"+d).length&&$(n).append(be(d,e)),$("#"+d).find(".plist-left-bar").append((t=r.tab,i="",s="scene=task-"+t+"-"+(a=e).id,l=a.thumb?a.thumb:StrackPHP.IMG+"/excel/excel_tasks.png",i+='<li id="review_task_item_'+a.id+'" class="play-list-items"><a id="item_task_'+a.id+'" href="javascript:;" class="choice" onclick="obj.select_review_task(this)"  data-id="'+a.id+'" data-urltag="'+s+'"><div class="task-thumb aign-left"><img src="'+l+'"></div><div class="playlist-name text-ellipsis aign-left"><div class="list-name-top"><span class="list_createby">'+a.created_by+'</span></div><div class="list-name-bottom">'+a.name+"</div></div></a>","no"===m.rule_task_delete&&(i+='<a href="javascript:;" class="playlist-button first" onclick="obj.delete_review_task(this)" data-id="'+a.id+'"><i class="icon-uniE6DB"></i></a>'),i+="</li>"))}),"new"===a&&l&&p.select_id&&obj.select_review_task(Strack.get_obj_by_id(p.select_id)),$("#st-load_all").remove()}})}function be(e,t){var a="";return a+='<div id="'+e+'" class="playlist-item-group"><div class="playlist-group-title"><div class="playlist-g-name aign-left"><i class=" icon-uniE717 icon-left"></i>'+t.group_name+'</div><a href="javascript:;" class="playlist-g-bnt aign-right" onclick="obj.toggle_playlist_group(this)" data-groupid="'+e+'"><i class="icon-uniF106 sidebar-icon"></i></a></div><div class="playlist-group-list" id="playlist-group-list1"><ul class="plist-left-bar"></ul></div></div>'}function ke(e,t){var a="";return a+='<div class="ui fluid vertical steps"><div class="step-title">'+e+"</div>"+t+"</div>"}function we(e){var t="",a="done"===e.status?"completed":"",i="yes"===e.active?"active":"",s="",l="";return e.note&&(s=e.note.created_by,l=e.note.text),t+='<div class="'+a+" "+i+' active step"><i class="remove icon"></i><div class="content"><div class="title">'+s+'</div><div class="description">'+l+"</div></div></div>"}function Se(){if(f&&!Strack.G.mediaScreenshotStatus){var e=$("#video_main"),t=e.width(),a=e.height(),i=t/a;e.find("canvas").css({width:t,height:a}),h.position.z=a/2,h.aspect=i,h.updateProjectionMatrix(),k.position.set(b.target.x,b.target.y,0),v.setSize(t,a)}}function $e(e,t){var a=m.project_id+".html";t&&(a+="?"+t),history.replaceState(null,e,a)}!function(){if(0<=$.inArray(p.url_scene,["task","playlist"])&&0<=$.inArray(p.url_tab,["my_review","all_task","my_create","all_playlist","follow"])&&p.url_id&&p.url_item_name)if("yes"===m.rule_palylist)$("#left_search_val").val(p.url_item_name),l.filter={name:["-lk","%"+p.url_item_name+"%"]},p.select_id="item_"+p.url_scene+"_"+p.url_id,me(p.url_scene,p.url_tab,!0);else switch(p.url_scene){case"task":_=p.url_id,c[_]={id:_,name:p.url_item_name},"no"===m.rule_review?(u("review_task_no_left"),G(p.url_id),ue("note",StrackLang.Feedback)):(u("review_task_no_side"),G(p.url_id));break;case"playlist":u("playlist_no_side"),D(p.url_id,"select")}else{var e="task",t="my_review";switch(p.url_scene){case"task":e=p.url_scene,0<=$.inArray(p.url_tab,["my_review","all_task"])&&(t=p.url_tab);break;case"playlist":e=p.url_scene,0<=$.inArray(p.url_tab,["my_create","all_playlist","follow"])&&(t=p.url_tab)}me(e,t,!1)}}()});